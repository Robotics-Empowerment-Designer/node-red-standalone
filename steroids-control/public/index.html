<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Steroids Control</title>
  <style>
    html {
      color-scheme: dark;
    }
  </style>
  <link href="vendor/bootstrap-5.3.3-dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <div class="container">
    <h1 style="margin-top: 20px; margin-bottom: 32px; text-align: center;">Steroids Control</h1>

    <p style="text-align: center;">
      <button id="status" class="btn btn-info">Status</button>
      <button id="start" class="btn btn-success">Start</button>
      <button id="stop" class="btn btn-danger">Stop</button>
      <button id="restart" class="btn btn-warning">Restart</button>
      <button id="pepper" class="btn btn-secondary">Pepper</button>
      <button id="salt" class="btn btn-secondary">Salt</button>
    </p>

    <div class="mt-4">
      <div id="output-spinner" hidden>
        <div class="d-flex justify-content-center">
          <div class="spinner-border text-primary m-5" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
        </div>
      </div>
      <div class="card" id="output-card">
        <div class="card-header">
          Terminal Output
        </div>
        <div class="card-body" style="background-color: black;">
          <pre><code id="output"></code></pre>
        </div>
      </div>
    </div>
    </div>

  <script>
    const statusBtn = document.getElementById("status")
    const startBtn = document.getElementById("start")
    const stopBtn = document.getElementById("stop")
    const pepperBtn = document.getElementById("pepper")
    const saltBtn = document.getElementById("salt")
    const restartBtn = document.getElementById("restart")
    const outputCard = document.getElementById("output-card")
    const outputSpinner = document.getElementById("output-spinner")
    const output = document.getElementById("output")
    const sendPostRequest = (endpoint) => {
      outputCard.hidden = true
      outputSpinner.hidden = false
      output.innerText = ""
      fetch(endpoint, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
      }).then(response => response.text()).then(data => {
        output.innerText = data
        outputSpinner.hidden = true
        outputCard.hidden = false
      }).catch(err => {
        output.innerText = "An error occured."
        outputSpinner.hidden = true
        outputCard.hidden = false
        console.error(err)
      })
    };

    statusBtn.addEventListener("click", () => {
      sendPostRequest("/status");
    });

    startBtn.addEventListener("click", () => {
      sendPostRequest("/start");
    });

    stopBtn.addEventListener("click", () => {
      sendPostRequest("/stop");
    });

    restartBtn.addEventListener("click", () => {
      sendPostRequest("/restart");
    });

    pepperBtn.addEventListener("click", () => {
      sendPostRequest("/pepper");
    });

    saltBtn.addEventListener("click", () => {
      sendPostRequest("/salt");
    });

    async function status() {
      const req = await fetch("/current")
      const data = await req.json()
      if (data.startsWith("pepper")) {
        pepperBtn.innerText = "Pepper (active)"
        saltBtn.innerText = "Salt"
      }
      if (data.startsWith("salt")) {
        saltBtn.innerText = "Salt (active)"
        pepperBtn.innerText = "Pepper"
      }
    }
    status();

    const checkStatus = setInterval(() => {
      status()
    }, 1000)
  </script>
  <script src="/vendor/bootstrap-5.3.3-dist/js/bootstrap.min.js"></script>
</body>
</html>
